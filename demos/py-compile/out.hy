(import sys) (import math) (import pymunk) (import [pyphysicssandbox [*]]) (import pygame) (import [pyphysicssandbox [Vec2d]]) (setv w 80) (setv h 80) (setv user_shapes []) (setv image_bindings []) (setv pivots []) (setv connected_shapes []) (setv click-handled 2) (window "Most Awesome Thing Ever" w h) (do (defn make_obj2 [off-x off-y] (do (do (setv obj2 (ball [(+ (int 40) (int off-x)) (+ (int 40)) (int off-y)] 40)) (setv obj2.color (Color "white")) (setv obj2.group 2) (setv obj2_image (pygame.image.load "./obj2.png")) (image-bindings.append [obj2 obj2_image]) (user_shapes.append obj2) (do (setv (. obj2 mass) 10)) obj2))) (setv obj2 (make_obj2 0 0))) (defn image-for [s] (do (global image-bindings) (for (b image-bindings) (if (= (. b [0]) s) (return (. b [1])))) (return False))) (defn draw-images [cosmetic] (do (defn f [keys] (do (global user-shapes) (for (s user-shapes) (if (not (image-for s)) (continue)) (if (not (= cosmetic (. s _cosmetic))) (continue)) (if (not (. s active)) (continue)) (if (. s body) (setv p (Vec2d (. s body position x) (. s body position y))) (setv p (Vec2d (. s _x) (. s _y)))) (setv angle 0) (if (. s body) (setv angle (. s body angle))) (setv angle_degrees (math.degrees angle)) (setv rotated_logo_img (pygame.transform.rotate (image-for s) (* -1 angle-degrees))) (setv offset (/ (Vec2d (rotated_logo_img.get_size)) 2)) (setv p (- p offset)) (setv screen (pygame.display.get-surface)) (screen.blit rotated_logo_img p)))) (return f))) (defn draw_pivot_lines [keys] (do (global pivots) (for (p pivots) (setv start (. p body position)) (for (j (. p shape)) (if (not p.active) (continue)) (setv other (. j a)) (setv end (. other position)) (setv screen (pygame.display.get_surface)) (pygame.draw.line screen (Color "black") start end))))) (defn draw_connection_lines [keys] (do (for (c connected_shapes) (setv start (. c [0] body position)) (setv end (. c [1] body position)) (if (or (not (. c [0] active)) (not (. c [1] active))) (do (deactivate (. c [2])) (continue))) (setv screen (pygame.display.get_surface)) (pygame.draw.line screen (Color "black") start end)))) (defn clear-click [keys] (do (do (global click-handled) (setv click-handled (max 0 (- click-handled 1)))))) (add-observer clear-click) (add-observer (draw-images True)) (add-observer draw_pivot_lines) (add-observer draw_connection_lines) (add-observer (draw-images False)) (run)